<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Security Scanner</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'MS Sans Serif', Arial, sans-serif;
      background: #c0c0c0;
      padding: 20px;
      color: #000;
      height: 100vh;
      overflow: auto;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    h1 {
      font-size: 16px;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px groove #fff;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section {
      background: #fff;
      border: 2px inset #808080;
      padding: 15px;
      margin-bottom: 20px;
    }

    .section-title {
      font-weight: bold;
      margin-bottom: 10px;
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .button {
      padding: 8px 16px;
      background: #c0c0c0;
      border: 2px outset #fff;
      cursor: pointer;
      font-family: 'MS Sans Serif', Arial, sans-serif;
      font-size: 11px;
    }

    .button:active {
      border-style: inset;
    }

    .button:hover {
      background: #d4d4d4;
    }

    .button-primary {
      background: #000080;
      color: #fff;
      font-weight: bold;
    }

    .button-primary:hover {
      background: #0000a0;
    }

    .button-danger {
      background: #c00000;
      color: #fff;
      font-weight: bold;
    }

    .button-danger:hover {
      background: #a00000;
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .scan-type-selector {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
    }

    .scan-type-selector label {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 11px;
      cursor: pointer;
    }

    .progress-bar {
      width: 100%;
      height: 20px;
      background: #fff;
      border: 2px inset #808080;
      margin: 15px 0;
      position: relative;
      display: none;
    }

    .progress-bar.show {
      display: block;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(to right, #000080, #1084d0);
      transition: width 0.3s;
    }

    .progress-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 10px;
      font-weight: bold;
      color: #000;
    }

    .results-area {
      max-height: 400px;
      overflow-y: auto;
      margin-top: 15px;
      display: none;
    }

    .results-area.show {
      display: block;
    }

    .result-item {
      padding: 12px;
      margin-bottom: 10px;
      border: 2px solid;
      background: #fff;
    }

    .result-item.safe {
      border-color: #00a000;
      background: #f0fff0;
    }

    .result-item.warning {
      border-color: #ffa500;
      background: #fffaf0;
    }

    .result-item.danger {
      border-color: #c00000;
      background: #fff0f0;
    }

    .result-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
      font-weight: bold;
      font-size: 12px;
    }

    .result-icon {
      font-size: 20px;
    }

    .result-details {
      font-size: 11px;
      line-height: 1.6;
      margin-left: 30px;
    }

    .result-details ul {
      margin: 5px 0 5px 20px;
    }

    .result-details li {
      margin: 3px 0;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }

    .stat-box {
      background: #e0e0e0;
      border: 2px inset #808080;
      padding: 10px;
      text-align: center;
    }

    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: #000080;
    }

    .stat-label {
      font-size: 10px;
      color: #666;
      margin-top: 5px;
    }

    .info-box {
      background: #ffffcc;
      border: 1px solid #808080;
      padding: 12px;
      margin-bottom: 15px;
      font-size: 11px;
      line-height: 1.6;
    }

    .info-box strong {
      display: block;
      margin-bottom: 5px;
    }

    .url-input-wrapper {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    .url-input {
      flex: 1;
      padding: 6px;
      border: 2px inset #808080;
      font-family: 'MS Sans Serif', Arial, sans-serif;
      font-size: 11px;
    }

    .severity-badge {
      display: inline-block;
      padding: 2px 8px;
      font-size: 10px;
      font-weight: bold;
      border-radius: 3px;
      margin-left: 10px;
    }

    .severity-badge.safe {
      background: #00a000;
      color: #fff;
    }

    .severity-badge.warning {
      background: #ffa500;
      color: #000;
    }

    .severity-badge.danger {
      background: #c00000;
      color: #fff;
    }

    .code-block {
      background: #f0f0f0;
      border: 1px solid #ccc;
      padding: 8px;
      font-family: 'Courier New', monospace;
      font-size: 10px;
      margin: 5px 0;
      white-space: pre-wrap;
      word-break: break-all;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üõ°Ô∏è Security Scanner</h1>

    <div class="section">
      <div class="section-title">üìã Scan Type</div>
      
      <div class="scan-type-selector">
        <label>
          <input type="radio" name="scanType" value="installed" checked onchange="updateScanType()">
          Scan Installed Apps
        </label>
        <label>
          <input type="radio" name="scanType" value="url" onchange="updateScanType()">
          Scan URL/App Before Installing
        </label>
      </div>

      <div id="urlInputSection" style="display: none;">
        <div class="url-input-wrapper">
          <input type="text" class="url-input" id="urlInput" placeholder="https://example.com or paste HTML content">
          <button class="button" onclick="scanUrl()">Analyze</button>
        </div>
      </div>

      <div class="info-box">
        <strong>‚ÑπÔ∏è What this scanner checks:</strong>
        ‚Ä¢ Malicious script patterns (XSS, code injection)<br>
        ‚Ä¢ Suspicious iframe usage<br>
        ‚Ä¢ External resource loading<br>
        ‚Ä¢ localStorage/sessionStorage access<br>
        ‚Ä¢ Dangerous API calls (eval, innerHTML, etc.)<br>
        ‚Ä¢ Suspicious URL patterns<br>
        ‚Ä¢ Obfuscated code detection
      </div>

      <div class="button-group">
        <button class="button button-primary" onclick="startScan()" id="scanButton">
          üîç Start Security Scan
        </button>
        <button class="button" onclick="clearResults()" id="clearButton" style="display: none;">
          üóëÔ∏è Clear Results
        </button>
      </div>

      <div class="progress-bar" id="progressBar">
        <div class="progress-fill" id="progressFill"></div>
        <div class="progress-text" id="progressText">0%</div>
      </div>
    </div>

    <div id="statsSection" style="display: none;">
      <div class="section">
        <div class="section-title">üìä Scan Summary</div>
        <div class="stats-grid">
          <div class="stat-box">
            <div class="stat-value" id="totalScanned">0</div>
            <div class="stat-label">Total Scanned</div>
          </div>
          <div class="stat-box" style="background: #f0fff0;">
            <div class="stat-value" style="color: #00a000;" id="safeCount">0</div>
            <div class="stat-label">Safe</div>
          </div>
          <div class="stat-box" style="background: #fffaf0;">
            <div class="stat-value" style="color: #ffa500;" id="warningCount">0</div>
            <div class="stat-label">Warnings</div>
          </div>
          <div class="stat-box" style="background: #fff0f0;">
            <div class="stat-value" style="color: #c00000;" id="dangerCount">0</div>
            <div class="stat-label">Dangerous</div>
          </div>
        </div>
      </div>
    </div>

    <div class="results-area" id="resultsArea"></div>
  </div>

  <script>
    const STORAGE_KEY = 'os_installed_apps';
    let currentScanType = 'installed';

    function updateScanType() {
      const selected = document.querySelector('input[name="scanType"]:checked').value;
      currentScanType = selected;
      document.getElementById('urlInputSection').style.display = selected === 'url' ? 'block' : 'none';
    }

    function getInstalledApps() {
      try {
        return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
      } catch {
        return [];
      }
    }

    function analyzeContent(content, url = '') {
      const issues = [];
      let severity = 'safe';

      // Check for dangerous patterns
      const dangerousPatterns = [
        { pattern: /<script[^>]*>[\s\S]*?eval\s*\(/gi, message: 'Dangerous eval() usage detected', level: 'danger' },
        { pattern: /document\.write/gi, message: 'document.write() usage (potential XSS)', level: 'warning' },
        { pattern: /innerHTML\s*=/gi, message: 'innerHTML assignment (potential XSS)', level: 'warning' },
        { pattern: /\.src\s*=\s*[^'"][^>]*\+/gi, message: 'Dynamic script source manipulation', level: 'danger' },
        { pattern: /on\w+\s*=\s*["'][^"']*["']/gi, message: 'Inline event handlers detected', level: 'warning' },
        { pattern: /javascript:/gi, message: 'javascript: protocol usage', level: 'danger' },
        { pattern: /<iframe[^>]*srcdoc/gi, message: 'iframe with srcdoc (check content)', level: 'warning' },
        { pattern: /btoa|atob/gi, message: 'Base64 encoding/decoding (possible obfuscation)', level: 'warning' },
        { pattern: /unescape|decodeURI/gi, message: 'URI decoding (possible obfuscation)', level: 'warning' },
        { pattern: /fromCharCode/gi, message: 'Character code conversion (obfuscation)', level: 'warning' },
        { pattern: /localStorage|sessionStorage/gi, message: 'Browser storage access detected', level: 'warning' },
        { pattern: /XMLHttpRequest|fetch\(/gi, message: 'External HTTP requests detected', level: 'warning' },
        { pattern: /\.postMessage\(/gi, message: 'postMessage usage (check target origin)', level: 'warning' },
        { pattern: /new\s+Function\s*\(/gi, message: 'Dynamic function creation', level: 'danger' },
        { pattern: /window\.open/gi, message: 'window.open() usage (popup)', level: 'warning' },
      ];

      dangerousPatterns.forEach(({ pattern, message, level }) => {
        const matches = content.match(pattern);
        if (matches) {
          issues.push({
            message,
            level,
            count: matches.length
          });
          if (level === 'danger') severity = 'danger';
          else if (level === 'warning' && severity !== 'danger') severity = 'warning';
        }
      });

      // Check for suspicious external resources
      const externalScripts = content.match(/<script[^>]*src\s*=\s*["']([^"']+)["']/gi);
      if (externalScripts && externalScripts.length > 0) {
        const untrustedDomains = externalScripts.filter(script => {
          const trusted = ['cdnjs.cloudflare.com', 'unpkg.com', 'cdn.jsdelivr.net'];
          return !trusted.some(domain => script.includes(domain));
        });
        
        if (untrustedDomains.length > 0) {
          issues.push({
            message: `Loading scripts from ${untrustedDomains.length} untrusted domain(s)`,
            level: 'warning',
            details: untrustedDomains
          });
          if (severity !== 'danger') severity = 'warning';
        }
      }

      // Check URL if provided
      if (url) {
        const suspiciousUrlPatterns = [
          { pattern: /data:text\/html/i, message: 'Data URI detected (embedded content)' },
          { pattern: /[<>'"]/g, message: 'Special characters in URL' },
        ];

        suspiciousUrlPatterns.forEach(({ pattern, message }) => {
          if (pattern.test(url)) {
            issues.push({
              message,
              level: 'warning'
            });
            if (severity !== 'danger') severity = 'warning';
          }
        });
      }

      // Check for obfuscated code
      const codeLines = content.split('\n');
      const longLines = codeLines.filter(line => line.length > 500);
      if (longLines.length > 5) {
        issues.push({
          message: 'Possibly obfuscated code (very long lines)',
          level: 'warning',
          count: longLines.length
        });
        if (severity !== 'danger') severity = 'warning';
      }

      return { issues, severity };
    }

    function renderResults(results) {
      const resultsArea = document.getElementById('resultsArea');
      resultsArea.innerHTML = '';

      let safeCount = 0, warningCount = 0, dangerCount = 0;

      results.forEach(result => {
        if (result.severity === 'safe') safeCount++;
        else if (result.severity === 'warning') warningCount++;
        else if (result.severity === 'danger') dangerCount++;

        const icons = {
          safe: '‚úÖ',
          warning: '‚ö†Ô∏è',
          danger: 'üö®'
        };

        const item = document.createElement('div');
        item.className = `result-item ${result.severity}`;
        
        let issuesHtml = '';
        if (result.issues.length > 0) {
          issuesHtml = '<ul>' + result.issues.map(issue => {
            const countStr = issue.count ? ` (${issue.count} occurrence${issue.count > 1 ? 's' : ''})` : '';
            const detailsStr = issue.details ? '<div class="code-block">' + issue.details.slice(0, 3).join('\n') + '</div>' : '';
            return `<li>${issue.message}${countStr}${detailsStr}</li>`;
          }).join('') + '</ul>';
        }

        item.innerHTML = `
          <div class="result-header">
            <span class="result-icon">${icons[result.severity]}</span>
            <span>${result.name}</span>
            <span class="severity-badge ${result.severity}">${result.severity.toUpperCase()}</span>
          </div>
          <div class="result-details">
            ${result.issues.length === 0 
              ? 'No security issues detected.' 
              : `<strong>Issues found:</strong>${issuesHtml}`}
            ${result.url ? `<div style="margin-top: 8px;"><strong>URL:</strong> <span style="word-break: break-all;">${result.url}</span></div>` : ''}
          </div>
        `;
        
        resultsArea.appendChild(item);
      });

      // Update stats
      document.getElementById('totalScanned').textContent = results.length;
      document.getElementById('safeCount').textContent = safeCount;
      document.getElementById('warningCount').textContent = warningCount;
      document.getElementById('dangerCount').textContent = dangerCount;

      document.getElementById('statsSection').style.display = 'block';
      resultsArea.classList.add('show');
      document.getElementById('clearButton').style.display = 'inline-block';
    }

    async function startScan() {
      if (currentScanType === 'installed') {
        scanInstalledApps();
      } else {
        scanUrl();
      }
    }

    async function scanInstalledApps() {
      const apps = getInstalledApps();
      
      if (apps.length === 0) {
        alert('No installed apps found to scan.');
        return;
      }

      const progressBar = document.getElementById('progressBar');
      const progressFill = document.getElementById('progressFill');
      const progressText = document.getElementById('progressText');
      
      progressBar.classList.add('show');
      document.getElementById('scanButton').disabled = true;

      const results = [];

      for (let i = 0; i < apps.length; i++) {
        const app = apps[i];
        const progress = Math.round(((i + 1) / apps.length) * 100);
        progressFill.style.width = progress + '%';
        progressText.textContent = progress + '%';

        let content = '';
        if (app.content) {
          content = app.content;
        } else if (app.url) {
          content = `<iframe src="${app.url}"></iframe>`;
        }

        const analysis = analyzeContent(content, app.url || '');
        
        results.push({
          name: app.title,
          url: app.url,
          severity: analysis.severity,
          issues: analysis.issues
        });

        await new Promise(resolve => setTimeout(resolve, 100));
      }

      progressBar.classList.remove('show');
      document.getElementById('scanButton').disabled = false;
      
      renderResults(results);
    }

    async function scanUrl() {
      const input = document.getElementById('urlInput').value.trim();
      
      if (!input) {
        alert('Please enter a URL or HTML content');
        return;
      }

      const progressBar = document.getElementById('progressBar');
      progressBar.classList.add('show');
      document.getElementById('progressFill').style.width = '50%';
      document.getElementById('progressText').textContent = 'Analyzing...';

      // Simulate analysis delay
      await new Promise(resolve => setTimeout(resolve, 500));

      let content = input;
      let url = '';

      if (input.startsWith('http://') || input.startsWith('https://')) {
        url = input;
        content = `<iframe src="${input}"></iframe>`;
      }

      const analysis = analyzeContent(content, url);
      
      progressBar.classList.remove('show');
      
      renderResults([{
        name: url || 'HTML Content',
        url: url,
        severity: analysis.severity,
        issues: analysis.issues
      }]);
    }

    function clearResults() {
      document.getElementById('resultsArea').classList.remove('show');
      document.getElementById('resultsArea').innerHTML = '';
      document.getElementById('statsSection').style.display = 'none';
      document.getElementById('clearButton').style.display = 'none';
    }
  </script>
</body>
</html>